{% comment %} {% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>View Genres</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    body { background: #f0f2f5; padding-top: 70px; }
    .table-container {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      max-width: 900px;
      margin: auto;
    }
    .genre-img {
      width: 80px;
      height: 50px;
      object-fit: cover;
      border-radius: 4px;
    }
    .btn {
      margin-right: 5px;
    }
  </style>
</head>
<body>

{% include "library/navbar.html" %}
{% if messages %}
  <div class="container mt-3">
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
       
      </div>
    {% endfor %}
  </div>
{% endif %}

<div class="container mt-5">
  <div class="table-container">
    <h3 class="text-center mb-4">ðŸ“‚ Genre Management</h3>
    <!--search box-->
    <div class="d-flex justify-content-center mb-4">
      <input type="text" id="genreSearch" class="form-control text-center"
             placeholder="ðŸ” Search Genres..." style="max-width: 400px;">
    </div>


    <table class="table table-bordered table-hover text-center">
      <thead class="thead-dark">
        <tr>
          <th>ID</th>
          <th>Genre Name</th>
          <th>Image</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="genreTable">
        {% for genre in genres %} 
        
        <tr>
           
          <td>{{ forloop.counter0|add:genres.start_index }}</td>

           <td>{{ genre.name }}</td>
          <td>
            {% if genre.image %}
              <img src="{{ genre.image.url }}" class="genre-img" alt="{{ genre.name }}">
            {% else %}
              <span class="text-muted">No Image</span>
            {% endif %}
          </td>
          <td>
            <a href="{% url 'edit_genre' genre.id %}" class="btn btn-sm btn-warning">Edit</a>
            <a href="{% url 'delete_genre' genre.id %}" class="btn btn-sm btn-danger" onclick="return confirm('Delete this genre?')">Delete</a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="4" class="text-muted">No genres added yet.</td>
        </tr>
        {% endfor %}
      </tbody>
      
    </table>
    <div class="d-flex justify-content-center mt-4">
  <nav>
    <ul class="pagination">
      {% if genres.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?page={{ genres.previous_page_number }}">&laquo;</a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">&laquo;</span></li>
      {% endif %}

      {% for num in genres.paginator.page_range %}
        {% if genres.number == num %}
          <li class="page-item active"><span class="page-link">{{ num }}</span></li>
        {% elif num > genres.number|add:"-3" and num < genres.number|add:"3" %}
          <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
        {% endif %}
      {% endfor %}

      {% if genres.has_next %}
        <li class="page-item">
          <a class="page-link" href="?page={{ genres.next_page_number }}">&raquo;</a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">&raquo;</span></li>
      {% endif %}
    </ul>
  </nav>
</div>

  </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
 
  
    function liveSearch(inputId, tableBodyId) {
    $("#" + inputId).on("input", function () {
      const value = $(this).val().toLowerCase();
      $("#" + tableBodyId + " tr").each(function () {
        const rowText = $(this).text().toLowerCase();
        $(this).toggle(rowText.indexOf(value) > -1);
      });
    });
  }

  $(document).ready(function () {
    liveSearch("genreSearch", "genreTable");
    

  });
</script>

</body>
</html> {% endcomment %}

{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>View Genres</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    body { background: #f0f2f5; padding-top: 70px; }
    .table-container {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      max-width: 900px;
      margin: auto;
    }
    .genre-img {
      width: 80px;
      height: 50px;
      object-fit: cover;
      border-radius: 4px;
    }
    .btn {
      margin-right: 5px;
    }
  </style>
</head>
<body>

{% include "library/navbar.html" %}
{% if messages %}
  <div class="container mt-3">
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
      </div>
    {% endfor %}
  </div>
{% endif %}

<div class="container mt-5">
  <div class="table-container">
    <h3 class="text-center mb-4">ðŸ“‚ Genre Management</h3>

    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4 class="mb-0"></h4>
      <a href="{% url 'add_genre' %}" class="btn btn-success">âž• Add Genre</a>
    </div>

   <form method="get" class="row align-items-center mb-4">
  <!-- Search Input + Buttons -->
  <div class="col-md-7 d-flex">
    <input type="text" name="q" value="{{ query }}" class="form-control mx-3" placeholder="ðŸ” Search Genres..." style="width: 60%;">
    <button type="submit" class="btn btn-primary me-2 ">Search</button>
    <a href="{% url 'view_genres' %}" class="btn btn-secondary">Reset</a>
      <!-- âœ… Export Button -->
  <a href="?{% if query %}q={{ query }}&{% endif %}export=1" class="btn btn-success">
    Export Genres
  </a>
  </div>

  <!-- Entries Dropdown -->
  <div class="col-md-5 d-flex justify-content-md-end mt-2 mt-md-0">
    <label for="entries" class="mx-3 pt-1 fw-bold">Show</label>
    <select name="entries" id="entries" class="form-control" style="width: 100px;" onchange="this.form.submit()">
      <option value="10" {% if entries_per_page == 10 %}selected{% endif %}>10</option>
      <option value="25" {% if entries_per_page == 25 %}selected{% endif %}>25</option>
      <option value="50" {% if entries_per_page == 50 %}selected{% endif %}>50</option>
    </select>
  </div>
</form>



    <table class="table table-bordered table-hover text-center">
      <thead class="thead-dark">
        <tr>
          <th>S.No</th>
          <th>Genre Name</th>
          <th>Image</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for genre in genres %}
        <tr>
          <td>{{ forloop.counter0|add:genres.start_index }}</td>
          <td>{{ genre.name }}</td>
          <td>
            {% if genre.image %}
              <img src="{{ genre.image.url }}" class="genre-img" alt="{{ genre.name }}">
            {% else %}
              <span class="text-muted">No Image</span>
            {% endif %}
          </td>
          <td>
            <a href="{% url 'edit_genre' genre.id %}" class="btn btn-sm btn-warning">Edit</a>
            <a href="{% url 'delete_genre' genre.id %}" class="btn btn-sm btn-danger" onclick="return confirm('Delete this genre?')">Delete</a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="4" class="text-muted">No genres found.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- Pagination -->
    <div class="d-flex justify-content-center mt-4">
      <nav>
        <ul class="pagination">
          {% if genres.has_previous %}
            <li class="page-item">
              <a class="page-link" href="?q={{ query }}&entries={{ entries_per_page }}&page={{ genres.previous_page_number }}">&laquo;</a>
            </li>
          {% else %}
            <li class="page-item disabled"><span class="page-link">&laquo;</span></li>
          {% endif %}

          {% for num in genres.paginator.page_range %}
            {% if num == genres.number %}
              <li class="page-item active"><span class="page-link">{{ num }}</span></li>
            {% elif num > genres.number|add:"-3" and num < genres.number|add:"3" %}
              <li class="page-item"><a class="page-link" href="?q={{ query }}&entries={{ entries_per_page }}&page={{ num }}">{{ num }}</a></li>
            {% endif %}
          {% endfor %}

          {% if genres.has_next %}
            <li class="page-item">
              <a class="page-link" href="?q={{ query }}&entries={{ entries_per_page }}&page={{ genres.next_page_number }}">&raquo;</a>
            </li>
          {% else %}
            <li class="page-item disabled"><span class="page-link">&raquo;</span></li>
          {% endif %}
        </ul>
      </nav>
    </div>
  </div>
</div>

</body>
</html>
